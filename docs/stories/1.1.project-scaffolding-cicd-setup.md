# Story 1.1: Project Scaffolding & CI/CD Setup

## Status
Draft

## Story
**As a** Product Owner,
**I want** the project monorepo and a basic CI/CD pipeline to be set up,
**so that** we have a stable, automated foundation for development and deployment from day one.

## Acceptance Criteria
1. A monorepo is created and initialized with a basic folder structure for the backend and frontend applications.
2. A "Health Check" endpoint exists on the backend that returns a 200 OK status.
3. A basic CI pipeline runs on every commit, installing dependencies and running linters.
4. The CI pipeline automatically deploys the backend and a placeholder frontend to a development environment.

## Tasks / Subtasks

- [ ] **Setup Monorepo Structure** (AC: 1)
  - [ ] Initialize root package.json with workspaces configuration
  - [ ] Create apps/web/ directory for Next.js fullstack application
  - [ ] Create packages/shared-types/ directory for TypeScript interfaces
  - [ ] Create packages/ui/ directory for shadcn/ui components
  - [ ] Create packages/config/ directory for shared configuration
  - [ ] Setup Turborepo configuration (turbo.json)
  - [ ] Configure TypeScript workspace references

- [ ] **Initialize Next.js Application** (AC: 1, 2)
  - [ ] Create Next.js app with TypeScript in apps/web/
  - [ ] Setup App Router directory structure (src/app/)
  - [ ] Configure basic folder structure following unified project structure
  - [ ] Install core dependencies: Next.js (~14.x), TypeScript (~5.x), Tailwind CSS (~3.x)
  - [ ] Create basic layout.tsx and page.tsx files
  - [ ] Create health check API route at /api/health (AC: 2)

- [ ] **Configure Development Tooling** (AC: 3)
  - [ ] Setup ESLint configuration with architectural rules
  - [ ] Setup Prettier for code formatting
  - [ ] Configure TypeScript strict mode
  - [ ] Setup Husky for pre-commit hooks
  - [ ] Configure lint-staged for staged files checking
  - [ ] Create .gitignore and .cursorignore files

- [ ] **Database Foundation Setup** (AC: 1)
  - [ ] Install Prisma ORM (~5.x)
  - [ ] Create initial database schema structure
  - [ ] Setup database connection configuration
  - [ ] Create docker-compose.yml for local PostgreSQL
  - [ ] Configure Prisma client generation

- [ ] **CI/CD Pipeline Implementation** (AC: 3, 4)
  - [ ] Create GitHub Actions workflow (.github/workflows/ci-cd.yml)
  - [ ] Configure test job with PostgreSQL service
  - [ ] Setup automated linting and type checking
  - [ ] Configure Vercel deployment for preview environments
  - [ ] Setup production deployment automation
  - [ ] Configure environment variable management
  - [ ] Add deployment health checks

- [ ] **Basic Authentication Setup** (AC: 1)
  - [ ] Install Auth.js/NextAuth (~5.x) 
  - [ ] Create basic auth configuration
  - [ ] Setup JWT session strategy
  - [ ] Create placeholder login page structure

- [ ] **Package Scripts Configuration** (AC: 1)
  - [ ] Configure root package.json scripts for monorepo management
  - [ ] Setup development scripts (dev, build, test, lint)
  - [ ] Configure database scripts (db:generate, db:migrate, db:seed)
  - [ ] Setup Turborepo build orchestration

## Dev Notes

### Architecture Context
This story establishes the foundational infrastructure based on the comprehensive architecture documented in the sharded architecture files.

### Technology Stack [Source: architecture/tech-stack.md]
- **Frontend Framework:** Next.js (~14.x) with App Router
- **Backend Framework:** Next.js API Routes (serverless functions)
- **Language:** TypeScript (~5.x) with strict mode enabled
- **Build System:** Turborepo (~1.x) for monorepo orchestration
- **Database:** PostgreSQL (16.x) with Prisma ORM (~5.x)
- **Deployment Platform:** Vercel with Edge Network
- **CI/CD:** GitHub Actions integrated with Vercel deployment
- **Authentication:** Auth.js/NextAuth (~5.x)

### Project Structure [Source: architecture/unified-project-structure.md]
The monorepo structure must follow the exact layout specified:
```
emma-companionship/
├── apps/web/                     # Next.js fullstack application
├── packages/
│   ├── shared-types/            # TypeScript interfaces
│   ├── ui/                      # shadcn/ui components
│   └── config/                  # Shared configuration
├── .github/workflows/           # CI/CD workflows
├── scripts/                     # Build and deployment scripts
└── docs/                        # Project documentation
```

### Health Check API Endpoint [Source: architecture/backend-architecture.md]
Create `/api/health` endpoint that returns:
```typescript
{
  "status": "ok",
  "timestamp": "2024-12-19T...",
  "environment": "development",
  "database": "connected"
}
```

### CI/CD Pipeline Requirements [Source: architecture/deployment-architecture.md]
The GitHub Actions workflow must include:
- **Test Job:** PostgreSQL service, dependency installation, linting, type checking
- **Preview Deployment:** Automatic deployment on PR with preview URL commenting
- **Production Deployment:** Deployment on main branch merge with health checks
- **Environment Variables:** Proper secret management for different environments

### Development Workflow [Source: architecture/development-workflow.md]
Must support the following commands:
- `pnpm dev` - Start development server
- `pnpm build` - Build for production
- `pnpm lint` - Code linting
- `pnpm type-check` - TypeScript validation
- `pnpm db:generate` - Prisma client generation

### Coding Standards [Source: architecture/coding-standards.md]
Critical rules to enforce from the start:
- **TypeScript Strict Mode:** Enable strict flag, forbid `any` type
- **Import Organization:** Use absolute imports with `@/` prefix
- **Environment Variables:** Never access `process.env` directly in application code
- **Module Boundaries:** Enforce through ESLint rules
- **Code Formatting:** Prettier with pre-commit hooks

### File Locations
- **Root Configuration:** `package.json`, `turbo.json`, `.gitignore`
- **Next.js App:** `apps/web/src/app/` (App Router structure)
- **API Routes:** `apps/web/src/app/api/health/route.ts`
- **CI/CD:** `.github/workflows/ci-cd.yml`
- **Database:** `apps/web/prisma/schema.prisma`
- **Docker:** `docker-compose.yml` (root level)

## Testing

### Testing Strategy [Source: architecture/testing-strategy.md]
- **Test Organization:** Co-located tests with `.test.ts/.test.tsx` suffix
- **Fixtures:** Store in `__tests__/fixtures/` directories
- **Framework:** Jest + React Testing Library for frontend, Supertest for API routes
- **CI Integration:** Tests run automatically in GitHub Actions with PostgreSQL service

### Required Tests for This Story
- Health check endpoint test (`apps/web/src/app/api/health/route.test.ts`)
- Basic page rendering tests
- Build process validation
- Environment configuration validation

### Test Commands
- `pnpm test` - Run all tests
- `pnpm test:watch` - Run tests in watch mode
- `pnpm test:integration` - Integration tests with database

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2024-12-19 | 1.0.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*This section will be populated by QA Agent after story completion*
