# Story 1.1: Project Scaffolding & CI/CD Setup

## Status
Draft

## Story
**As a** Product Owner,
**I want** the project monorepo and a basic CI/CD pipeline to be set up,
**so that** we have a stable, automated foundation for development and deployment from day one.

## Acceptance Criteria
1. A monorepo is created and initialized with a basic folder structure for the backend and frontend applications.
2. A "Health Check" endpoint exists on the backend that returns a 200 OK status.
3. A basic CI pipeline runs on every commit, installing dependencies and running linters.
4. The CI pipeline automatically deploys the backend and a placeholder frontend to a development environment.

## Tasks / Subtasks
- [ ] Initialize Nx monorepo and baseline structure (AC: 1)
  - [ ] Scaffold Nx workspace with Next.js app `web` and enable pnpm workspaces (AC: 1)
  - [ ] Create base folders per Unified Project Structure (apps/web, packages/shared-types, packages/ui, packages/config) (AC: 1) [Source: architecture/unified-project-structure.md]
  - [ ] Add baseline configs: `nx.json`, root `package.json`, TS/ESLint/Prettier using Nx defaults (AC: 1) [Source: architecture/development-workflow.md]
- [ ] Add core dependencies and scripts (AC: 1)
  - [ ] Install Next.js, TypeScript, Prisma, Auth.js, Tailwind CSS, TanStack Query; set up root and app-level scripts (AC: 1) [Source: architecture/tech-stack.md]
  - [ ] Add Docker Compose for local PostgreSQL and npm scripts for db lifecycle (AC: 1) [Source: architecture/development-workflow.md]
- [ ] Implement backend health check endpoint (AC: 2)
  - [ ] Create `/apps/web/src/app/api/health/route.ts` returning `{ status: 'ok' }` with HTTP 200 (AC: 2) [Source: architecture/deployment-architecture.md]
  - [ ] Add a simple test to assert 200 OK response (AC: 2) [Source: architecture/testing-strategy.md]
- [ ] Establish baseline quality gates (AC: 3)
  - [ ] Configure `pnpm lint`, `pnpm type-check`, and `pnpm test` to run in repo root (AC: 3) [Source: architecture/development-workflow.md]
  - [ ] Ensure Nx targets exist: `nx lint web`, `nx test web`, `nx build web` (AC: 3) [Source: architecture/development-workflow.md]
- [ ] CI/CD enablement (see note) (AC: 3, 4)
  - [ ] Add GitHub Actions workflow `ci-cd.yml` to run type-check, lint, unit/integration tests, and build (AC: 3) [Source: architecture/deployment-architecture.md]
  - [ ] Configure preview deploy to Vercel using `vercel build` and `vercel deploy --prebuilt` (AC: 4) [Source: architecture/deployment-architecture.md]
  - [ ] Configure production deployment on `main` with post-deploy DB migrate step (AC: 4) [Source: architecture/deployment-architecture.md]
  - [ ] If CI deferral is required for POC, document manual Vercel deployment path and temporary disablement strategy (see Notes) [Source: architecture/deployment-architecture.md]

## Dev Notes

- Monorepo & Tooling
  - Use Nx as the monorepo tool with task graph and caching. Scaffold `apps/web` as Next.js fullstack app and prepare `packages/` for shared types/components/config. [Source: architecture/unified-project-structure.md]
  - Keep structure aligned to Unified Project Structure (apps/web/src/app, components, hooks, lib/api, lib/modules, etc.). [Source: architecture/unified-project-structure.md]
  - Core technologies: Next.js App Router, TypeScript, Prisma, Auth.js, TanStack Query; React Flow is planned for a later phase. [Source: architecture/tech-stack.md]

- Development Workflow
  - Baseline commands exist for install, dev, build, lint, format, type-check, and tests; Nx equivalents should be available (`nx serve web`, `nx build web`, `nx test web`, `nx lint web`, `nx graph`). [Source: architecture/development-workflow.md]
  - Local DB via Docker Compose, with scripts for `db:start`, `db:generate`, `db:migrate`, `db:seed`. [Source: architecture/development-workflow.md]

- Health Check Endpoint
  - Implement health route under Next.js API routes to validate serverless readiness and provide CI smoke checks. [Source: architecture/deployment-architecture.md]

- CI/CD and Deployment
  - Architecture documents a planned GitHub Actions pipeline and a POC manual deploy path via Vercel CLI; for this story, include the pipeline file and parameters to satisfy AC 3–4, with clear toggles to allow interim manual deploy if needed. [Source: architecture/deployment-architecture.md]

### Testing
- Follow the Testing Strategy pyramid; for this story add:
  - Unit test for health endpoint (Backend Unit). [Source: architecture/testing-strategy.md]
  - Optional integration smoke in CI to hit `/api/health` after build. [Source: architecture/testing-strategy.md]
- Use Jest + Supertest for API route tests. [Source: architecture/tech-stack.md]

### Project Structure Notes
- The PRD AC requires a running CI pipeline and auto-deploy on every commit (AC 3–4). Current architecture notes mark GitHub Actions as “planned” for POC with a manual Vercel deployment path. For consistency, we will:
  - Include the Actions workflow file and enable it if CI is approved for POC, or
  - Keep it present but disabled (e.g., limited triggers or a protection rule) while using manual deploys, documenting this exception until CI is formally enabled. [Source: architecture/deployment-architecture.md]

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-09-18 | 0.1.0 | Initial draft created from Epic 1.1 and architecture v4 | Scrum Master |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

