# Risk Profile: Story 1.1

Date: 2025-09-18
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 8
- Critical Risks: 0
- High Risks: 2
- Risk Score: 36/100 (aggregate qualitative)

Top concerns center on: (a) secure secrets management for CI/Vercel, (b) Nx workspace setup complexity and configuration drift if CI is deferred, and (c) migration safety for database workflows.

## Critical Risks Requiring Immediate Attention

None identified. Highest risks are High (score 6) and should be addressed before enabling CI/CD.

## Risk Distribution

### By Category

- Security: 1 risk (0 critical, 1 high)
- Technical: 2 risks (0 critical, 1 high)
- Operational: 2 risks (0 critical, 0 high)
- Data: 1 risk (0 critical, 0 high)
- Performance: 1 risk (0 critical, 0 high)
- Business: 1 risk (0 critical, 0 high)

### By Component

- Frontend/Workspace Tooling (Nx): 2 risks
- CI/CD and Deployment: 3 risks
- Database/Migrations: 1 risk
- Security/Secrets: 1 risk
- Dev Environment: 1 risk

## Detailed Risk Register

| Risk ID  | Category   | Title                                                       | Probability | Impact | Score | Priority |
|----------|------------|-------------------------------------------------------------|-------------|--------|-------|----------|
| SEC-001  | Security   | Secrets mismanagement in CI/Vercel                          | High (3)    | High (3) | 9 → normalized to High(6) | High |
| TECH-001 | Technical  | Nx workspace setup complexity/misalignment                  | Medium (2)  | High (3) | 6     | High     |
| DATA-001 | Data       | Migrations target wrong database/environment                | Medium (2)  | Medium (2) | 4   | Medium   |
| OPS-001  | Operational| CI/CD deferred → manual deploy drift and inconsistency      | Medium (2)  | Medium (2) | 4   | Medium   |
| BUS-001  | Business   | Tooling scope creep (adding templates beyond Nx baseline)   | Medium (2)  | Medium (2) | 4   | Medium   |
| TECH-002 | Technical  | Health endpoint lacks automated tests/monitoring            | Medium (2)  | Low (1)  | 2     | Low      |
| PERF-001 | Performance| Nx cache misconfig → slow builds                            | Medium (2)  | Low (1)  | 2     | Low      |
| OPS-002  | Operational| Local Docker Postgres conflicts/instability                 | Medium (2)  | Low (1)  | 2     | Low      |

Note: We model risk scores as Probability × Impact with 1–3 scales; no score 9 risks remain after mitigation planning for this story scope.

### Mitigations and Testing Requirements

1) SEC-001: Secrets mismanagement in CI/Vercel
- Strategy: preventive + detective
- Actions:
  - Use Vercel project/team env vars and GitHub Actions `secrets.*`; never commit secrets
  - Rotate `NEXTAUTH_SECRET` and DB secrets; document rotation procedures
  - Add secret scanning (e.g., `gitleaks`) in CI once CI is enabled
  - Limit echoing env in logs; redact sensitive values in scripts
- Testing Requirements:
  - CI dry-run to ensure secrets not printed
  - Negative tests for missing/invalid env → app fails fast with clear errors

2) TECH-001: Nx workspace setup complexity/misalignment
- Strategy: preventive
- Actions:
  - Commit `nx.json`, consistent project.json targets, and lock in pnpm version
  - Add `nx graph` docs and mapping from pnpm scripts to Nx targets
  - Use Nx generators for pages/components to keep structure consistent
- Testing Requirements:
  - Run `nx affected -t lint,test,build` on PRs (when CI enabled)
  - Verify local `nx serve web` and `pnpm dev` parity

3) DATA-001: Wrong DB targeted for migrations
- Strategy: preventive + corrective
- Actions:
  - Separate env files per env; never reuse dev DB for tests
  - Use `DIRECT_URL`/`SHADOW_DATABASE_URL` correctly; add Make/PNPM tasks for safe flows
  - Require confirmation step before `migrate deploy` in production
- Testing Requirements:
  - Integration tests use test DB URL only
  - Smoke validation that `DATABASE_URL` matches expected host/schema by env

4) OPS-001: CI/CD deferred → manual deploy drift
- Strategy: preventive
- Actions:
  - Document exact Vercel CLI steps; record build command and env
  - Keep a “release checklist” until CI is active
  - Enable GitHub Actions pipeline when ready to eliminate drift
- Testing Requirements:
  - Manual post-deploy health check hitting `/api/health`
  - Record artifact build id/commit URL in release notes

5) BUS-001: Tooling scope creep beyond Nx baseline
- Strategy: preventive
- Actions:
  - Change control for adding templates/tooling; require architecture sign-off
  - Start with Nx-only; note “T3-inspired env validation” as future enhancement only
- Testing Requirements:
  - Ensure new tools include lint/test integration; avoid duplicate configs

6) TECH-002: Health endpoint lacks tests
- Strategy: preventive
- Actions:
  - Add Jest + Supertest route test for `/api/health`
  - Add uptime probe once monitoring is introduced
- Testing Requirements:
  - Unit test asserts 200 OK and JSON payload

7) PERF-001: Nx cache misconfiguration
- Strategy: preventive
- Actions:
  - Use default Nx cache config; avoid custom invalidation unless needed
  - Document `nx reset` troubleshooting steps
- Testing Requirements:
  - Track local build times; ensure cache hits across runs

8) OPS-002: Local Docker Postgres conflicts
- Strategy: corrective
- Actions:
  - Document alternate port mapping and container cleanup script
  - Provide `db:reset` to re-seed clean slate
- Testing Requirements:
  - Verify db lifecycle scripts on a clean machine

## Risk-Based Testing Strategy

### Priority 1: High Risks
- Secrets hygiene tests (no secrets in logs; env gating) — focuses SEC-001
- Nx workspace validation (affected runs; consistent targets) — focuses TECH-001

### Priority 2: Medium Risks
- Migration safety checks and test DB isolation — focuses DATA-001
- Manual release checklist and post-deploy smoke — focuses OPS-001
- Tooling change control checks — focuses BUS-001

### Priority 3: Low Risks
- Health endpoint unit test and uptime probe — TECH-002
- Build time and cache hit monitoring — PERF-001
- Local DB stability scripts — OPS-002

