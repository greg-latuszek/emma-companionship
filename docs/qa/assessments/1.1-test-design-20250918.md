# Test Design: Story 1.1

Date: 2025-09-18
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 12
- Unit tests: 3 (25%)
- Integration tests: 8 (67%)
- E2E tests: 1 (8%) [Planned, post‑POC]
- Priority distribution: P0: 2, P1: 7, P2: 3

Notes:
- Per architecture, E2E is deferred for the POC. One deployment smoke E2E is defined as planned to prepare for CI enablement.
- Risk profile linkage included where relevant (SEC-001, TECH-001, DATA-001, OPS-001, TECH-002, PERF-001).

## Test Scenarios by Acceptance Criteria

### AC1: Monorepo created and initialized with basic folder structure

#### Scenarios

| ID            | Level       | Priority | Test                                              | Justification |
| ------------- | ----------- | -------- | ------------------------------------------------- | ------------- |
| 1.1-UNIT-001  | Unit        | P2       | Validate Nx project.json targets schema           | Pure config validation via JSON schema
| 1.1-INT-001   | Integration | P1       | `nx graph` runs without error                     | Workspace integrity (mitigates TECH-001)
| 1.1-INT-002   | Integration | P1       | `nx build web` succeeds                           | Build path correctness, baseline setup
| 1.1-INT-003   | Integration | P1       | Repo structure matches Unified Project Structure  | Scripted check against required directories

### AC2: Health Check endpoint returns 200 OK

#### Scenarios

| ID            | Level       | Priority | Test                                              | Justification |
| ------------- | ----------- | -------- | ------------------------------------------------- | ------------- |
| 1.1-UNIT-002  | Unit        | P1       | Route handler returns 200 with `{status:'ok'}`     | Pure handler logic (mitigates TECH-002)
| 1.1-INT-004   | Integration | P1       | Supertest GET `/api/health` → 200 + JSON shape    | API route wiring through Next.js runtime

### AC3: Basic CI pipeline runs on every commit (install deps, run linters)

#### Scenarios

| ID            | Level       | Priority | Test                                              | Justification |
| ------------- | ----------- | -------- | ------------------------------------------------- | ------------- |
| 1.1-INT-005   | Integration | P1       | `pnpm install --frozen-lockfile` succeeds         | Reproducible installs locally (CI parity)
| 1.1-INT-006   | Integration | P1       | `pnpm lint` and `pnpm type-check` succeed         | Baseline quality gates (mitigates OPS-001)
| 1.1-INT-007   | Integration | P2       | `nx affected -t lint,test,build` runs (no changes)| Validates affected config for future CI (TECH-001)

### AC4: CI pipeline automatically deploys backend and placeholder frontend

#### Scenarios

| ID            | Level       | Priority | Test                                              | Justification |
| ------------- | ----------- | -------- | ------------------------------------------------- | ------------- |
| 1.1-INT-008   | Integration | P1       | `vercel build` completes locally                  | Build artifact generation (OPS readiness)
| 1.1-E2E-001   | E2E         | P0       | Post-deploy smoke: `/api/health` returns 200      | Production readiness check (planned; mitigates OPS-001)

### Supporting: DB/Migrations and Secrets Hygiene (from Dev Notes and Risk)

#### Scenarios

| ID            | Level       | Priority | Test                                              | Justification |
| ------------- | ----------- | -------- | ------------------------------------------------- | ------------- |
| 1.1-UNIT-003  | Unit        | P0       | Env validation fails fast on missing secrets      | Prevents insecure defaults (mitigates SEC-001)
| 1.1-INT-009   | Integration | P1       | `pnpm db:generate` and `pnpm db:migrate` succeed  | Validates Prisma lifecycle scripts
| 1.1-INT-010   | Integration | P2       | Ensure test DB is used for tests only             | Prevents DATA cross‑contamination (DATA-001)
| 1.1-INT-011   | Integration | P2       | `nx reset` fixes cache‑related build failures     | Docs + script check for PERF-001

## Risk Coverage

- SEC-001: 1.1-UNIT-003 (env validation), 1.1-E2E-001 (no secrets in logs in pipeline, planned)
- TECH-001: 1.1-INT-001/002/007 (workspace validity and affected runs)
- DATA-001: 1.1-INT-009/010 (DB lifecycle and env isolation)
- OPS-001: 1.1-INT-006/008, 1.1-E2E-001 (pipeline and post‑deploy smoke)
- TECH-002: 1.1-UNIT-002, 1.1-INT-004 (health endpoint tests)
- PERF-001: 1.1-INT-011 (cache troubleshooting path)

## Recommended Execution Order

1. P0 Unit: 1.1-UNIT-003 (env validation)
2. P1 Unit/Integration: 1.1-UNIT-002, 1.1-INT-004 (health); 1.1-INT-001/002/006/008
3. P1 Integration: 1.1-INT-005, 1.1-INT-009
4. P2 Integration: 1.1-INT-003, 1.1-INT-007, 1.1-INT-010, 1.1-INT-011
5. P0 E2E (Planned): 1.1-E2E-001 when CI is enabled

---

test_design:
  scenarios_total: 12
  by_level:
    unit: 3
    integration: 8
    e2e: 1
  by_priority:
    p0: 2
    p1: 7
    p2: 3
  coverage_gaps: []

Test design matrix: qa.qaLocation/assessments/1.1-test-design-20250918.md
P0 tests identified: 2

